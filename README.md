# Магазин мерча

Сервис предоставляет интерфейс для покупки мерча, обмена монетками между пользователями и просмотра истории своих действий.

## Требования
- Docker
- migrate

## Установка и запуск
1. Склонируйте репозиторий, перейдите в папку merch-service, где лежит Makefile.
2. Запустите Docker.
3. Запустите базовую инфраструктуру сервиса:
    ```bash
    make up
4. Примените миграции:
    ```bash
    make migrate/up
5. Если что-то не работает, проверить конфликтующие порты (:8080, :5432, :6379) и поменять их в .env файле и докер композе.

## Тесты и линтеры
Конфигурация линтеров описана в `.golangci.yml`. 

В этом проекте используются линтеры для:

- Форматирования кода (gofmt, goimports).
- Поиска ошибок и багов (govet, staticcheck, errcheck).
- Анализа производительности и безопасности (gosec, gocritic, prealloc).
- Обнаружения дублирования и стилистических проблем (revive, dupl, nestif, misspell).

Запуск тестов и линтеров (необходим Docker): 
    ```
    make audit
    ```

Проверка покрытия: 
    ```
    make сoverage
    ```

Результаты нагрузочного тестирования (vegeta):
![vegeta](merch-service/docs/vegeta-plot.png)
## Пример API-запросов
Примеры запросов можно найти в файле `Recommendations-API.postman_collection.json`

Также доступна документация Swagger (после запуска сервиса): `http://localhost:8080/swagger/index.html`

### Вопрос 1. Разделить ли запрос на информацию о пользователях на подзапросы?
Да, код будет гораздо более читаем, также его можно будет переиспользовать в других местах, или легко отредактировать, если мы захотим поменять структуру ответа. Главный минус - возможная несогласованность данных в итоговом джсоне. Также больше обращений к базе данных. На мой взгляд, плюсы перевешивают минусы, и конкретно в этом запросе согласованность не так критична, а для скорости можем добавить кеширование.

Мелкие подзапросы: 0.18мс
1. Получение баланса + инвентаря - 0.08мс (с индексами)
2. Получение транзакций - 0.1мс (с индексами)

Один запрос: 0.15мс (без предварительной агрегации), или 0.35 с джсон агрегацией на стороне бд.